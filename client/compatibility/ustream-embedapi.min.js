var UstreamEmbed=function(){function a(a){return b(a)}function b(a){var b=c(a),m=function(a){function b(b){if("socialstream"!==b){if(!v)return x||(x=[]),x.push(arguments),void 0;var d=i(arguments).slice(1);d[0]&&"function"==typeof d[0]&&(y[b]||(y[b]=[]),y[b].push(d[0])),g(a,s,{cmd:b,args:d})}else if(j(window,"message",n),u=c(arguments[1]),t=h(u.getAttribute("src")),w=!0,A.length)for(var e=0,k=A.length;k>e;e++)f(A[e])}function m(){if(x){for(;x.length;)b.apply(this,x.shift());x=null}}function n(a){var b=u;b&&b.contentWindow&&b.contentWindow===a.source?r.onmessage(a):a.source===u.id&&r.onmessage(a)}function o(a){var c,d=JSON.parse(a.data);return d.cmd&&"ready"==d.cmd?(g(u,t,{cmd:"ready"}),void 0):(c=[d.cmd],c=c.concat(d.args),b.apply(this,c),void 0)}function p(){v=!0,g(a,s,{cmd:"apihandshake",args:[]}),m()}function q(){b.apply(this,arguments)}var r,s,t,u,v=!1,w=!1,x=[],y={},z={},A=[];return s=h(a.getAttribute("src")),r={host:s,callMethod:q,getProperty:function(){q.apply(this,arguments)},addListener:function(a,b){z[a]||(z[a]=[]),z[a].push(b)},removeListener:function(a,b){if(b)for(var c=0,d=z[a].length;d>c;c++)z[a][c]===b&&z[a].splice(c,1);else z[a]=null},onmessage:function(a){var b;if(s||t||A.push({origin:a.origin,data:a.data}),a.origin==s){try{b=JSON.parse(a.data)}catch(c){return}if(b.sstream)return o(a),void 0;if(b.event&&b.event.ready&&(p(),d(z,"ready")),b.event&&b.event.live===!0)return d(z,"live"),void 0;if(b.event&&b.event.live===!1)return d(z,"offline"),void 0;if(b.event&&!b.event.ready)if(k)Object.keys(b.event).forEach(function(a){d(z,a,b.event[a])});else for(var f in b.event)b.event.hasOwnProperty(f)&&d(z,f,b.event[f]);if(b.property)if(k)Object.keys(b.property).forEach(function(a){e(y,a,b.property[a])});else for(var f in b.property)b.property.hasOwnProperty(f)&&e(y,f,b.property[f])}else if(w&&a.origin==t)return o(a),void 0},destroy:function(){v=!1,s="",w=!1,t="",u=null,x=[],y={},z={},A=[],l[a.id]&&(l[a.id]=null),a=null}}}(b);return b.id||(b.id="UstreamEmbed"+Math.ceil(1e5*Math.random())),m.id=b.id,l[b.id]=m,m}function c(a){return"string"==typeof a&&(a=document.getElementById(a)),a}function d(a,b,c){for(var d in a[b])a[b].hasOwnProperty(d)&&a[b][d].call(window,b,c)}function e(a,b,c){if(a[b]){for(var d in a[b])a[b].hasOwnProperty(d)&&a[b][d].call(window,c);a[b]=null,delete a[b]}}function f(a){var b,c;for(b in l)l.hasOwnProperty(b)&&l[b]&&(c=document.getElementById(b),c&&c.contentWindow?c.contentWindow===a.source&&l[b].onmessage(a):"string"==typeof a.source&&a.source==b&&l[b].onmessage(a))}function g(a,b,c){a.contentWindow.postMessage(JSON.stringify(c),b)}function h(a){return a.indexOf("http")<0&&(a=location.protocol+a),a.match(m)[1].toString()}function i(a){return Array.prototype.slice.call(a,0)}function j(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)}var k="undefined"!=typeof Object.keys,l={},m=new RegExp("^(http(?:s)?://[^/]+)","im");return j(window,"message",f),"function"==typeof define&&define.amd?(define([],function(){return a}),void 0):window.UstreamEmbed=a}();